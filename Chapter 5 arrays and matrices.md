# Chapter 5 arrays and matrices
[原书链接](https://cran.r-project.org/doc/manuals/r-release/R-intro.pdf)  
### arrays
维度向量(dimension vector)表示数组的长度，它是只包括正整数的向量。dim是数组的一个属性，如：
```r
> x<-c(3,5,6,4,3,7,78,21,45,99,4,3,5,2,3,6,4,3,66,54,43,65,43,26)
> dim(x)<-c(4,6)
> x
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    3   45    5    4   43
[2,]    5    7   99    2    3   65
[3,]    6   78    4    3   66   43
[4,]    4   21    3    6   54   26
```
以上代码就通过dim属性讲x数组定位为4×6维的数组。可以看到数组内元素的分布是首先通过第一列往下，再第二列，最后再第六列。这就涉及到数组内元素的填入顺序。  
dim(x)<-c(4,6)中，‘4’是第一个下标，‘6’是第二个下标，数组在填入元素是，首先变化第一个下标，即顺序为[1,1][2,1][3,1][4,1]，接下来再变化第二个下标，从1变为2，再继续变第一个下标，即[2,1][2,2][3,2][4,2]，依此类推。这种填入次序叫做**FORTRAN次序**。

接下来再看一个数组的定义：
```r
> x<-c(3,5,6,4,3,7,78,21,45,99,4,3,5,2,3,6,4,3,66,54,43,65,43,26)

# 4个2×3数组

> dim(x)<-c(2,3,4)
> x
, , 1

     [,1] [,2] [,3]
[1,]    3    6    3
[2,]    5    4    7

, , 2

     [,1] [,2] [,3]
[1,]   78   45    4
[2,]   21   99    3

, , 3

     [,1] [,2] [,3]
[1,]    5    3    4
[2,]    2    6    3

, , 4

     [,1] [,2] [,3]
[1,]   66   43   43
[2,]   54   65   26
```
依然是第一个下标最先变化，最后一个下标最后变化。

### array indexing
```r
> x
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    3   45    5    4   43
[2,]    5    7   99    2    3   65
[3,]    6   78    4    3   66   43
[4,]    4   21    3    6   54   26
> x[2,2]
[1] 7
> x[2, ]
[1]  5  7 99  2  3 65
> x[ ,4]
[1] 5 2 3 6
```
这个很好理解啦o_o括号里用来索引的数字/空格就是索引向量(index vector)。
### index matrices
除了索引向量，还有索引矩阵。顾名思义，上文中用来索引的是两个数字/空格+数字组成的向量，那么索引矩阵就是用矩阵来进行索引。
```r
> x
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    3   45    5    4   43
[2,]    5    7   99    2    3   65
[3,]    6   78    4    3   66   43
[4,]    4   21    3    6   54   26
> y<-c(1:3,3:1)
> y
[1] 1 2 3 3 2 1
> dim(y)<-c(3,2)
> y
     [,1] [,2]
[1,]    1    3
[2,]    2    2
[3,]    3    1
> x[y]
[1] 45  7  6
```
这段代码里用来索引的就是矩阵y，最后索引的结果即x[1,3],x[2,2],x[3,1]。  
值得注意的是，索引矩阵里的元素不可以是负数，可以是0和NA，如果是0的话索引时就会忽略它，如果是NA索引的结果也是NA，如：
```r
> x
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    3   45    5    4   43
[2,]    5    7   99    2    3   65
[3,]    6   78    4    3   66   43
[4,]    4   21    3    6   54   26
> z<-c(0,3,NA,2,1,2)
> dim(z)<-c(3,2)
> z
     [,1] [,2]
[1,]    0    2
[2,]    3    1
[3,]   NA    2
> x[z]
[1]  6 NA
```
### array()函数
除了通过赋给一个向量dim属性，还可以直接通过array()函数来构建数组，它的用法是array(data_vector,dim_vector)。  
```r
> x<-c(3,2,5,4,6,8,7,3,4,1)
> y<-array(x,c(5,2))
> y
     [,1] [,2]
[1,]    3    8
[2,]    2    7
[3,]    5    3
[4,]    4    4
[5,]    6    1
```
这里有几个特殊情况：
1. 如果上文中的x向量中没有10个元素
```r
> x<-c(3,2,5,4,6,8,7,3)
> y<-array(x,c(5,2))
> y
     [,1] [,2]
[1,]    3    8
[2,]    2    7
[3,]    5    3
[4,]    4    3
[5,]    6    2
```
数组在填入元素时，会按照FORTRAN次序依次填入，当元素不够时，会回到向量开头继续循环。
2. 当向量为0时，构建的数组所有元素都是0
```r
> a<-array(0,c(2,3))
> a
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
```
### the outer product（外积） of two arrays
ab<-a%o%b  
ab<-outer(a,b,'*')
### generalized transpose of an array
转置矩阵直接用t()函数：
```r
> x<-array(c(1:9),c(3,3))
> x
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
> t(x)
     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6
[3,]    7    8    9
```
另外还有一个aperm()函数，是转置数组的函数。例如：
```r
> x<-array(c(1:24),c(2,3,4))
> x
, , 1
     [,1] [,2] [,3]
[1,]    1    3    5
[2,]    2    4    6
, , 2
     [,1] [,2] [,3]
[1,]    7    9   11
[2,]    8   10   12
, , 3
     [,1] [,2] [,3]
[1,]   13   15   17
[2,]   14   16   18
, , 4
     [,1] [,2] [,3]
[1,]   19   21   23
[2,]   20   22   24
> aperm(x,c(3,1,2))
, , 1
     [,1] [,2]
[1,]    1    2
[2,]    7    8
[3,]   13   14
[4,]   19   20
, , 2
     [,1] [,2]
[1,]    3    4
[2,]    9   10
[3,]   15   16
[4,]   21   22
, , 3
     [,1] [,2]
[1,]    5    6
[2,]   11   12
[3,]   17   18
[4,]   23   24
```
aperm(x,c(3,1,2))的意思是将原来x数组里的第三个维度当作第一个维度，第一个维度当作第二个维度，第二个维度当作第三个维度。  
既然矩阵是特殊的数组，那么t()函数也可以用asperm()来代替，即：
```r
> x<-array(c(1:9),c(3,3))
> x
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
> asperm(x,c(2,1))
     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6
[3,]    7    8    9
```
也就是把x的第二个维度（列：[1,2,3][4,5,6][7,8,9]）当作第一个维度（行），第一个维度（行）当作第二个维度（列）。
### matrix facilities
针对矩阵有很多单独的方法和函数，t(x)可以转置矩阵x，nrow(x)和ncol(x)可以得出矩阵x的行数和列数。
#### 矩阵相乘
