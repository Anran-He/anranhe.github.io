# 用python批量下载图片保存到本地并进行图像识别
因为课程作业需要批量下载图片，我在上网搜了资料+整合老师的代码后顺利用python实现了这项功能，在这里记个笔记，免得以后还有用到。  
参考CSDN：https://blog.csdn.net/weixin_30824277/article/details/97051211

## 第一步：准备一个存有图片url的csv文件
我是先用八爪鱼采集器将某条微博转发用户的头像链接采集下来，直接生成了这样一个文件。

## 第二步：导入链接，下载图片到本地
首先导入必要的库。
```py
import pandas as pd
import os,base64
import requests
from PIL import Image
from io import BytesIO
import numpy as np
```
读取csv数据（我的数据是有关三八节的一条微博下的转发用户，所以用sanba来命名）。
```py
sanba = pd.read_csv('sanbaimage.csv')
```
将dataframe转化为列表。
```py
list = np.array(sanba).tolist()
list = sum(list,[])
```
读取链接，下载到本地。
```py
i = 1
for url in list:
    response = requests.get(url)
    image = Image.open(BytesIO(response.content))

    ls_f = base64.b64encode(BytesIO(response.content).read())

    imgdata = base64.b64decode(ls_f)

    file = open('image%d.jpg' %i,'wb')
    file.write(imgdata)
    file.close()

    i += 1
  ```

  ## 第三步：调用百度API，进行图像识别
  在百度智能云平台上注册账号，可以获取API key和secret，从而进行一些便捷的图像识别，详细信息可访问百度智能云平台上的API文档。
  ```python
  from aip import AipImageClassify
  APP_ID = 'xxxx'
  API_KEY = 'xxxx'
  SECRET_KEY = 'xxxx'
  client = AipImageClassify(APP_ID, API_KEY, SECRET_KEY)

  def get_file_content (filePath):
    with open(filePath, 'rb') as fp:
        return fp.read()

  df = pd.DataFrame(columns = ['Image_ID', 'Keyword', 'Root', 'Score'])

  import time
  # 看一下下载了多少张图片在本地，修改range(1,298)
  for i in range(1,298):
    filePath = r'D:\user_image\image%d.jpg' %i
    image = get_file_content(filePath)
    reco_result = client.advancedGeneral(image)
    for result in reco_result['result']:
        df_newrow = pd.DataFrame({'Image_ID': [i],
                                  'Keyword': [result['keyword']],
                                  'Root': [result['root']],
                                  'Score': [result['score']]})
        df = df.append(df_newrow, ignore_index=True)
    time.sleep(0.5)
  ```

  ## 第四步：将数据框保存为本地csv文件
  ```python
df.to_csv(r'sanba_image_result.csv',index=False,encoding="utf_8_sig")
# 中文字符需要加上encoding="utf_8_sig"
  ```
