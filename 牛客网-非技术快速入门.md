## 1. 基础查询
### SQL1 查询多列
```SQL
select device_id, gender, age, university from user_profile
```
### SQL2 查询所有列
```SQL
select * from user_profile
```
## 2. 简单处理查询结果
### SQL3 查询结果去重
```SQL
select distinct university from user_profile
```
### SQL4 查询结果限制返回行数
```SQL
select device_id from user_profile
limit 2
```
### SQL5 将查询后的列重命名
```SQL
select device_id as user_infos_example from user_profile
limit 2
``` 
## 3. 基础操作符
### SQL6 查找学校是北大的学生信息
```SQL
select device_id, university from user_profile
where university='北京大学'
```
### SQL7 查找年龄大于24岁的用户信息
```SQL
select device_id, gender, age, university from user_profile
where age>24
```
### SQL8 查找某个年龄段的用户信息
```SQL
select device_id, gender, age from user_profile
where age between 20 and 23
```
### SQL9 查找除复旦大学的用户信息
```SQL
select device_id, gender, age, university from user_profile
where university<>'复旦大学'
```
### SQL10 用where过滤空值
```SQL
select device_id, gender, age, university from user_profile
where age IS NOT NULL
```
## 4. 高级操作符
### SQL11 高级操作符练习(1)
```SQL
select device_id, gender, age, university, gpa from user_profile
where gender = 'male' and gpa > 3.5
```
### SQL12 高级操作符练习(2）
```SQL
select device_id, gender, age, university, gpa from user_profile
where university = '北京大学' or gpa > 3.7
```
### SQL13 Where in 和Not in
```SQL
select device_id, gender, age, university, gpa from user_profile
where university in ('北京大学','复旦大学','山东大学')
```
### SQL14 操作符混合运用
```SQL
--and优先级大于or
select device_id, gender, age, university, gpa from user_profile
where gpa > 3.5 and university = '山东大学' or gpa > 3.8 and university = '复旦大学'
```
### SQL15 查看学校名称中含北京的用户
```SQL
--'like %''模糊匹配
select device_id, age, university from user_profile
where university like '%北京%'
```
## 5. 计算函数
### SQL16 查找GPA最高值
```SQL
select max(gpa) from user_profile
where university = '复旦大学'
```
### SQL17 计算男生人数以及平均GPA
```SQL
select COUNT(id) as male_num, AVG(gpa) as avg_gpa from user_profile
where gender = 'male'
```
## 6. 分组查询
### SQL18 分组计算练习题
```SQL
select gender, university, COUNT(id) as user_num, AVG(active_days_within_30) as avg_active_day,
AVG(question_cnt) as avg_question_cnt from user_profile
group by gender, university
```
### SQL19 分组过滤练习题
```SQL
--聚合函数作为删选条件时，不能用where，只能用having
select university, AVG(question_cnt) as avg_question_cnt, AVG(answer_cnt) as avg_answer_cnt
from user_profile
group by university
having AVG(question_cnt) < 5 or AVG(answer_cnt) < 20
```

### SQL20 分组排序练习题
```SQL
select university, AVG(question_cnt) as avg_question_cnt
from user_profile
group by university order by avg_question_cnt
```

## 7. 子查询
### SQL21 浙江大学用户题目回答情况
```SQL
--join
select a.device_id, b.question_id, b.result from user_profile a inner join question_practice_detail b on a.device_id = b.device_id 
where a.university = '浙江大学'
order by b.question_id
--不用join
select device_id, question_id, result from question_practice_detail
where device_id = 
(select device_id from user_profile where university = '浙江大学')
order by question_id
```
## 8. 链接查询
### SQL22 统计每个学校的答过题的用户的平均答题数
```SQL
select university, COUNT(question_id)/COUNT(distinct q.device_id) as avg_answer_cnt
from user_profile u left join question_practice_detail q
on u.device_id = q.device_id
group by university
```

### SQL23 统计每个学校各难度的用户平均刷题数
```SQL
select university, c.difficult_level, count(b.question_id)/count(distinct b.device_id) as avg_answer_cnt
from ((user_profile a cross join question_practice_detail b on a.device_id=b.device_id)
cross join question_detail c on b.question_id=c.question_id)
group by university, difficult_level
```

### SQL24 统计每个用户的平均刷题数
```SQL
select university, difficult_level, COUNT(qd.question_id)/COUNT(distinct qpd.device_id) as avg_answer_cnt
from ((user_profile u cross join question_practice_detail qpd on u.device_id = qpd.device_id) cross join question_detail qd on qpd.question_id = qd.question_id)
where university = '山东大学'
group by difficult_level
```

## 9. 组合查询
### SQL25 查找山东大学或者性别为男生的信息
```SQL
select device_id, gender, age, gpa
from user_profile
where university = '山东大学'
union all
select device_id, gender, age, gpa
from user_profile
where gender = 'male'
```
## 10. 条件函数
### SQL26 计算25岁以上和以下的用户数量
```SQL
SELECT
if(age>=25,'25岁及以上','25岁以下') as age_cut,
count(*) as number
from user_profile
group by age_cut
```
### SQL27 查看不同年龄段的用户明细
```SQL
select device_id, gender,
case
when age<20 then '20岁以下'
when age between 20 and 24 then '20-24岁'
when age>=25 then '25岁及以上'
else '其他'
end as age_cut
from user_profile
```

## 11. 日期函数
### SQL28 计算用户8月每天的练题数量
```SQL
select day(date) as day, count(question_id) as question_cnt
from question_practice_detail
where date between '2021-08-01' and '2021-08-31'
group by day
```

### SQL29 计算用户的平均次日留存率
```SQL
SELECT count(b.device_id)/count(a.device_id) as avg_ret
FROM 
(select distinct device_id, date from question_practice_detail) a
left join
(select distinct device_id, date_sub(date,interval 1 day) as date from question_practice_detail) b
on a.date=b.date and a.device_id=b.device_id
```

## 12. 文本函数
### SQL30 统计每种性别的人数
```SQL
select substring_index(profile, ',',-1) as gender, count(*) as number
from user_submit
group by gender
```
### SQL31 提取博客URL中的用户名
```SQL
select device_id, substring_index(blog_url, '/', -1) as user_name
from user_submit
```
### SQL32 截取出年龄
```SQL
select substring(profile, 12, 2) as age, count(*) as number
from  user_submit
group by age
```
## 13. 窗口函数
### SQL33 找出每个学校GPA最低的同学
```SQL
select device_id, university, gpa
from (select device_id, university, gpa, row_number() over (partition by university order by gpa)as rk from user_profile) a
where rk = 1
```
## 14. 综合练习
### SQL34 统计复旦用户8月练题情况
```SQL
select u.device_id, u.university, count(question_id) as question_cnt,
sum(case 
      when result = 'right' then 1
      else 0 
      end)
as right_question_cnt
from user_profile u left join question_practice_detail q
on u.device_id = q.device_id
where university = '复旦大学' and (month(date) = 8 or month(date) is null)
group by u.device_id
```

### SQL35 浙大不同难度题目的正确率
```SQL
select difficult_level, 
sum(case when result = 'right' then 1 else 0 end)/count(result) as correct_rate
from ((user_profile u cross join question_practice_detail qpd on u.device_id = qpd.device_id)
cross join question_detail qd on qpd.question_id = qd.question_id)
where university = '浙江大学'
group by difficult_level
order by correct_rate
```

### 15. 基础排序
```SQL
select device_id, age
from user_profile
order by age
```

### SQL37 查找后多列排序
```SQL
select device_id, gpa, age from user_profile
order by gpa, age
```

### SQL38 查找后降序排列
```SQL
select device_id, gpa, age from user_profile
order by gpa DESC, age DESC
```

### SQL39 21年8月份练题总数
```SQL
select count(distinct device_id) as did_cnt, count(question_id) as question_cnt
from question_practice_detail 
where month(date) = 8
```
